(this.webpackJsonpwebapp=this.webpackJsonpwebapp||[]).push([[0],{117:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),o=a(32),r=a.n(o),s=(a(38),a(4)),c=a(5),i=a(7),u=a(6),d={add:"Add","add-repo":"Add repository",build:"Build","build-log":"Build Log","build-requests":"Latest builds",cancel:"Cancel",complete:"Complete","confirm-delete":"Confirm delete","confirm-delete-message":"Are you sure you want to delete the build: ",created:"Created",delete:"Delete","getting-ready":"Getting ready for lift off...","in-progress":"In Progress","last-commit":"Last Commit",name:"Name",repo:"Repository","repo-list":"Watched repositories","scroll-off":"Auto-scroll Off","scroll-on":"Auto-scroll On",status:"Status",view:"View"};function m(e){return d[e]||e}function p(e){var t=m(e.code);return e.message&&(t+=": "+e.message),t}var h=[],f=function(e){Object(i.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={},n}return Object(c.a)(a,[{key:"link",value:function(e){return this.props.sectionId?"/"+this.props.section+"/"+this.props.sectionId+"/"+e:"/"+e}},{key:"render",value:function(){var e=this;return l.a.createElement("header",{id:"navigation",class:"p-navigation header-slim"},l.a.createElement("div",{className:"p-navigation__banner row"},l.a.createElement("div",{className:"p-navigation__logo"},l.a.createElement("div",{className:"u-vertically-center"},l.a.createElement("a",{href:"/",className:"p-navigation__link"},l.a.createElement("img",{src:"/static/images/fabrica.png",alt:"ubuntu"})))),l.a.createElement("nav",{className:"p-navigation__nav"},l.a.createElement("span",{className:"u-off-screen"},l.a.createElement("a",{href:"#navigation"},"Jump to site")),l.a.createElement("ul",{className:"p-navigation__links",role:"menu"},h.map((function(t){var a="";return e.props.section!==t&&e.props.subsection!==t||(a=" active"),l.a.createElement("li",{key:t,className:"p-navigation__link"+a,role:"menuitem"},l.a.createElement("a",{href:e.link(t)},m(t)))}))))))}}]),a}(n.Component),g=a(10),b=a(9),v=a.n(b);var E={baseUrl:window.location.protocol+"//"+window.location.hostname+":"+window.location.port+"/v1/"},C={build:function(e,t){return v.a.post(E.baseUrl+"build",{repo:e})},buildList:function(e){return v.a.get(E.baseUrl+"builds")},buildGet:function(e,t){return v.a.get(E.baseUrl+"builds/"+e)},buildDelete:function(e,t){return v.a.delete(E.baseUrl+"builds/"+e)},repoList:function(e){return v.a.get(E.baseUrl+"repos")},repoCreate:function(e,t){return v.a.post(E.baseUrl+"repos",{repo:e})}},k=a(1),w=function(e){Object(i.a)(a,e);var t=Object(u.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return l.a.createElement(k.Row,null,l.a.createElement(k.Card,null,l.a.createElement(k.Form,null,l.a.createElement(k.Input,{onChange:this.props.onChange,type:"text",id:"repo",placeholder:"https://github.com/ogra1/fabrica.git",label:"Git Repo",value:this.props.repo}),l.a.createElement(k.Button,{onClick:this.props.onClick,appearance:"positive"},m("add")),l.a.createElement(k.Button,{onClick:this.props.onCancel,appearance:"neutral"},m("cancel")))))}}]),a}(n.Component),D=function(e){Object(i.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).handleAddClick=function(e){e.preventDefault(),n.setState({showAdd:!0})},n.handleCancelClick=function(e){e.preventDefault(),n.setState({showAdd:!1})},n.handleRepoChange=function(e){e.preventDefault(),n.setState({repo:e.target.value})},n.handleRepoCreate=function(e){e.preventDefault(),C.repoCreate(n.state.repo).then((function(e){n.props.onCreate(),n.setState({error:"",showAdd:!1,repo:""})})).catch((function(e){console.log(p(e.response.data)),n.setState({error:p(e.response.data),message:""})}))},n.state={showAdd:!1,repo:""},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props.records.map((function(t){return{columns:[{content:t.name,role:"rowheader"},{content:t.repo},{content:t.hash},{content:t.created},{content:t.modified},{content:l.a.createElement(k.Button,{"data-key":t.id,onClick:e.props.onBuild},m("build"))}]}}));return l.a.createElement("section",null,l.a.createElement(k.Row,null,l.a.createElement("div",null,l.a.createElement("h3",{className:"u-float-left"},m("repo-list")),l.a.createElement(k.Button,{onClick:this.handleAddClick,className:"u-float-right"},m("add-repo"))),this.state.showAdd?l.a.createElement(w,{onClick:this.handleRepoCreate,onCancel:this.handleCancelClick,onChange:this.handleRepoChange,repo:this.state.repo}):"",l.a.createElement(k.MainTable,{headers:[{content:m("name")},{content:m("repo"),className:"col-large"},{content:m("last-commit")},{content:m("created")},{content:m("modified")},{content:m("actions")}],rows:t})))}}]),a}(n.Component);var y=function(e){return l.a.createElement("div",{className:"u-align--center"},function(e){return"complete"===e.status?l.a.createElement("i",{className:"p-icon--success"}):"failed"===e.status?l.a.createElement("i",{className:"p-icon--error"}):l.a.createElement("i",{className:"p-icon--spinner"})}(e))};var N=function(e){return l.a.createElement("div",null,l.a.createElement(k.Link,{href:"/builds/"+e.id,title:m("view")},l.a.createElement("img",{className:"action",src:"/static/images/show.svg",alt:m("view")})),e.download?l.a.createElement(k.Link,{href:"/v1/builds/"+e.id+"/download",title:m("download")},l.a.createElement("img",{className:"action",src:"/static/images/download.svg",alt:m("download")})):"",l.a.createElement(k.Link,{href:"",title:m("delete"),onClick:e.onConfirmDelete},l.a.createElement("img",{className:"action",src:"/static/images/delete.svg",alt:m("delete"),"data-key":e.id})))},O=a(13),j=a.n(O),S=function(e){Object(i.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).handleCancelDelete=function(e){e.preventDefault(),n.setState({confirmDelete:!1,delete:{}})},n.handleConfirmDelete=function(e){e.preventDefault();var t=e.target.getAttribute("data-key"),a=n.props.records.filter((function(e){return e.id===t}));a.length>0&&n.setState({confirmDelete:!0,delete:a[0]})},n.handleDoDelete=function(e){e.preventDefault(),n.props.onDelete(n.state.delete.id),n.setState({confirmDelete:!1,delete:{}})},n.state={confirmDelete:!1,delete:{}},n}return Object(c.a)(a,[{key:"renderConfirmDelete",value:function(){return l.a.createElement(k.Modal,{close:this.handleCancelDelete,title:m("confirm-delete")},l.a.createElement("p",null,m("confirm-delete-message")+this.state.delete.name+" ("+this.state.delete.created+")"),l.a.createElement("hr",null),l.a.createElement("div",{className:"u-align--right"},l.a.createElement("button",{onClick:this.handleCancelDelete,className:"u-no-margin--bottom"},m("cancel")),l.a.createElement("button",{className:"p-button--negative u-no-margin--bottom",onClick:this.handleDoDelete},m("delete"))))}},{key:"render",value:function(){var e=this,t=this.props.records.map((function(t){var a=j.a.duration(t.duration,"seconds").minutes()+" minutes";return t.duration<120&&(a=j.a.duration(t.duration,"seconds").seconds()+" seconds"),{columns:[{content:t.name,role:"rowheader"},{content:t.repo},{content:t.created},{content:l.a.createElement(y,{status:t.status})},{content:a,className:"col-medium u-align--left"},{content:l.a.createElement(N,{id:t.id,download:t.download,onConfirmDelete:e.handleConfirmDelete}),className:"col-medium u-align--left"}]}}));return l.a.createElement("section",null,this.state.confirmDelete?this.renderConfirmDelete():"",l.a.createElement(k.Row,null,l.a.createElement("h3",null,m("build-requests")),l.a.createElement(k.MainTable,{headers:[{content:m("name")},{content:m("repo"),className:"col-large"},{content:m("created")},{content:m("status"),className:"u-align--center col-small"},{content:m("duration"),className:"col-medium u-align--left"},{content:m("actions"),className:"col-medium u-align--left"}],rows:t})))}}]),a}(n.Component),B=function(e){Object(i.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).poll=function(){setTimeout(n.getDataBuilds.bind(Object(g.a)(n)),3e4)},n.handleRepoCreateClick=function(){n.getDataRepos()},n.handleBuildClick=function(e){e.preventDefault();var t=e.target.getAttribute("data-key");C.build(t).then((function(e){n.getDataBuilds()})).catch((function(e){console.log(p(e.response.data)),n.setState({error:p(e.response.data),message:""})}))},n.handleBuildDelete=function(e){C.buildDelete(e).then((function(e){n.getDataBuilds()})).catch((function(e){console.log(p(e.response.data)),n.setState({error:p(e.response.data),message:""})}))},n.state={repos:[{id:"aaa",name:"test",repo:"github.com/TestCompany/test",hash:"abcdef",created:"2020-05-14T19:01:34Z",modified:"2020-05-14T19:01:34Z"}],builds:[{id:"bbb",name:"test",repo:"github.com/TestCompany/test",status:"complete",duration:222,created:"2020-05-14T19:30:34Z"}]},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.getDataRepos(),this.getDataBuilds()}},{key:"getDataRepos",value:function(){var e=this;C.repoList().then((function(t){e.setState({repos:t.data.records})})).catch((function(t){console.log(p(t.response.data)),e.setState({error:p(t.response.data),message:""})}))}},{key:"getDataBuilds",value:function(){var e=this;C.buildList().then((function(t){e.setState({builds:t.data.records})})).catch((function(t){console.log(p(t.response.data)),e.setState({error:p(t.response.data),message:""})})).finally((function(){e.poll()}))}},{key:"render",value:function(){return l.a.createElement("div",null,this.state.error?l.a.createElement(k.Notification,{type:"negative",status:m("error")+":"},this.state.error):"",l.a.createElement(D,{records:this.state.repos,onBuild:this.handleBuildClick,onCreate:this.handleRepoCreateClick}),l.a.createElement(S,{records:this.state.builds,onDelete:this.handleBuildDelete}))}}]),a}(n.Component);var L=function(e){return l.a.createElement(k.Card,null,e.fields.map((function(e){return l.a.createElement(k.Row,null,l.a.createElement(k.Col,{size:2},e.label,":"),l.a.createElement(k.Col,{size:10,className:"field_value"},e.value))})))},R=function(e){Object(i.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).poll=function(){setTimeout(n.getData.bind(Object(g.a)(n)),500)},n.handleScrollClick=function(e){n.setState({scrollLog:!n.state.scrollLog},n.changeScroll)},n.state={build:{},error:"",scrollLog:!1},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.getData()}},{key:"getData",value:function(){var e=this;C.buildGet(this.props.buildId).then((function(t){e.setState({build:t.data.record,error:""},e.scrollToBottom)})).catch((function(t){e.setState({error:p(t.response.data),message:""})})).finally((function(){e.poll()}))}},{key:"scrollToBottom",value:function(){this.state.scrollLog&&window.scrollTo(0,document.body.clientHeight)}},{key:"changeScroll",value:function(){this.state.scrollLog||window.scrollTo(0,0)}},{key:"renderLog",value:function(){return this.state.build.logs?this.state.build.logs.map((function(e){return e.message+"\r\n"})):m("getting-ready")+"\r\n"}},{key:"render",value:function(){return l.a.createElement(k.Row,null,l.a.createElement("h3",null,m("build-log")),l.a.createElement(k.Row,null,this.state.error?l.a.createElement(k.Notification,{type:"negative",status:"Error:"},this.state.error):"",l.a.createElement(L,{fields:[{label:m("name"),value:this.state.build.name},{label:m("repo"),value:this.state.build.repo},{label:m("created"),value:this.state.build.created},{label:m("status"),value:m(this.state.build.status)}]}),this.state.scrollLog?"":l.a.createElement(k.Button,{className:"col-2",appearance:"neutral",onClick:this.handleScrollClick},m("scroll-on")),l.a.createElement(k.Code,{className:"log",s:!0},this.renderLog()),this.state.scrollLog?l.a.createElement(k.Button,{className:"col-2",appearance:"brand",onClick:this.handleScrollClick},m("scroll-off")):""))}}]),a}(n.Component),A=function(e){Object(i.a)(a,e);var t=Object(u.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=function(){var e=window.location.pathname.split("/");switch(e.length){case 2:return{section:e[1]};case 3:return{section:e[1],sectionId:e[2]};case 4:return{section:e[1],sectionId:e[2],subsection:e[3]};default:return{}}}();return l.a.createElement("div",null,l.a.createElement(f,null),""===e.section?l.a.createElement(B,null):"","builds"===e.section?l.a.createElement(R,{buildId:e.sectionId}):"")}}]),a}(n.Component);r.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(A,null)),document.getElementById("root"))},33:function(e,t,a){e.exports=a(117)},38:function(e,t,a){}},[[33,1,2]]]);
//# sourceMappingURL=main.68f145a3.chunk.js.map